(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,a=(0,e.createContext)(),s="LOADING",l="SUCCESS",c="ERROR",n=({children:t,classNameBase:a})=>{const s=(0,e.useRef)(null);return React.createElement("div",{ref:s,className:`wp-block-buttons is-layout-flex wp-block-buttons-is-layout-flex ${a}__buttons ${a}__buttons--back`},t)},r=({label:e="",buttonKey:t="",url:a=null,classNameBase:s,onClick:l})=>React.createElement("div",{className:`wp-block-button ${s}__button ${s}__button--${t}`},!!a&&React.createElement("a",{className:`wp-block-button__link ${s}__button-link ${s}__button-link--${t}`,href:a,dangerouslySetInnerHTML:{__html:e}}),!a&&React.createElement("button",{className:`wp-block-button__link ${s}__button-link ${s}__button-link--${t}`,type:"button",onClick:l,dangerouslySetInnerHTML:{__html:e}})),o=({element:a,data:o,selectedThemes:i,setSelectedThemes:m,setListData:_,setViewMode:u,listEndpoint:d})=>{const{classNameBase:h}=a.dataset,[$,p]=(()=>{const[t,a]=(0,e.useState)({state:"IDLE",error:"",data:[],headers:{}});return[t,e=>{a({...t,state:s}),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw Error({status:e.status,text:e.statusText||""});return e.json()})).then((e=>{a({state:l,data:e})})).catch((e=>{a({state:c,error:e.statusText||"fetch failed"})}))}]})();return(0,e.useEffect)((()=>{switch($.state){case s:_(null);break;case c:console.error("Gemport API error",$);break;case l:_($.data),u("list")}}),[$]),React.createElement("form",{className:`${h}__form`},React.createElement("div",{className:`${h}__form-inner`},React.createElement("ul",{className:`${h}__entries`},o.map((e=>React.createElement("li",{key:e.id,className:`${h}__entry ${h}__entry--${e.id}`},React.createElement("label",{className:`${h}__entry-label ${h}__entry-label--${e.id}`,htmlFor:`${h}__entry-checkbox ${h}__entry-checkbox--${e.id}`},React.createElement("input",{type:"checkbox",id:`${h}__entry-checkbox ${h}__entry-checkbox--${e.id}`,key:e.id,value:e.id,onChange:()=>(e=>{const{entryId:t,setSelectedThemes:a}=e;a((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))})({entryId:e.id,setSelectedThemes:m}),checked:i.includes(e.id)}),React.createElement("span",{className:`${h}__entry-name`},e.name)))))),React.createElement(n,{classNameBase:h},React.createElement(r,{classNameBase:h,buttonKey:"search",onClick:()=>{p(d)},label:(0,t.__)("Search offers","shp_gemport_search")}))))},i=e=>{const{data:a,classNameBase:s,setViewMode:l}=e,c=()=>React.createElement(n,{classNameBase:s},React.createElement(r,{classNameBase:s,buttonKey:"back",onClick:()=>l("form"),label:(0,t.__)("View search form","shp_gemport_search")}));return React.createElement("div",{className:`${s}__list`},React.createElement("div",{className:`${s}__list-inner`},!a?.length&&React.createElement("div",{className:`${s}__list-empty`,dangerouslySetInnerHTML:{__html:(0,t.__)("No matching offers found","shp_gemport_search")}}),!!a?.length&&React.createElement(React.Fragment,null,React.createElement(c,null),React.createElement("ul",{className:`${s}__list-entries`},a.map((e=>{let a=[];return e.contact_tel&&a.push(React.createElement("a",{href:`tel:${e.contact_tel}`},e.contact_tel)),e.contact_email&&a.push(React.createElement("a",{href:`mailto:${e.contact_email}`},e.contact_email)),React.createElement("li",{key:e.id,className:`${s}__list-entry ${s}__list-entry--${e.id}`},e.name&&React.createElement(React.Fragment,null,e.url&&React.createElement("h3",{className:`wp-block-heading ${s}__list-entry-title ${s}__list-entry-title--${e.id}`},React.createElement("a",{className:`${s}__list-entry-link ${s}__list-entry-link--${e.id}`,href:e.url,dangerouslySetInnerHTML:{__html:e.name}})),!e.url&&React.createElement("h3",{className:`wp-block-heading ${s}__list-entry-title ${s}__list-entry-title--${e.id}`,dangerouslySetInnerHTML:{__html:e.name}})),e.logo&&React.createElement("figure",{className:`wp-block-image ${s}__list-entry-figure`},!!e.url&&React.createElement("a",{className:`${s}__list-entry-link ${s}__list-entry-link--${e.id}`,href:e.url},React.createElement("img",{className:`${s}__list-entry-image ${s}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!e.url&&React.createElement("img",{className:`${s}__list-entry-image ${s}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),e.description&&React.createElement("div",{className:`${s}__list-entry-description ${s}__list-entry-description--${e.id}`,dangerouslySetInnerHTML:{__html:e.description}}),a.length&&React.createElement("div",{className:`${s}__list-entry-contact ${s}__list-entry-contact--${e.id}`},React.createElement("span",{className:`${s}__list-entry-contact-label ${s}__list-entry-contact-label--${e.id}`},(0,t.__)("Contact:","shp_gemport_search")),a.map((t=>React.createElement("span",{className:`${s}__list-entry-contact-value ${s}__list-entry-contact-value--${e.id}`},t)))),!!e.url&&React.createElement("div",{className:`${s}__list-entry-more ${s}__list-entry-more--${e.id}`},React.createElement(n,null,React.createElement(r,{classNameBase:s,buttonKey:"more",url:e.url,label:(0,t.__)("More information","shp_gemport_search")}))))})))),React.createElement(c,null)))},m=({element:t})=>{const n={element:t},{classNameBase:r,generation:m,postcode:_}=t.dataset,[u]=(0,e.useState)(_||""),[d,h]=(0,e.useState)(""),[$,p]=(0,e.useState)([]),[y,E]=(0,e.useState)("form"),[b,R]=(0,e.useState)([]),g=(0,e.useMemo)((()=>`https://gemport.ch/gemport/public/api/themes?generation=${m}`),[]),N=$.join(","),f=(0,e.useMemo)((()=>{let e=`https://gemport.ch/gemport/public/api/offerings?zipcode=${u}`;return N&&(e+=`&theme=[${N}]`),d&&(e+=`&search=${d}`),e}),[u,N,d]),{data:k,error:w,state:S}=(t=>{const[a,n]=(0,e.useState)({state:s,error:"",data:[],headers:{}}),r=e=>n({...a,...e});return(0,e.useEffect)((()=>{r({state:s}),fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e.status&&e.status>399)throw Error({status:e.status,text:e.statusText?e.statusText:""});return e})).then((e=>e.json())).then((e=>{r({state:l,data:e})})).catch((e=>{r({state:c,error:e.statusText?e.statusText:"fetch failed"})}))}),[]),a})(g);return S===s?"":(S===c&&console.log("Gemport API error",w),React.createElement(a.Provider,{value:n},React.createElement("div",{className:`${r}__inner`},"form"===y&&React.createElement(o,{classNameBase:r,element:t,data:k,listEndpoint:f,selectedThemes:$,setListData:R,setSelectedThemes:p,setViewMode:E}),"list"===y&&React.createElement(i,{classNameBase:r,data:b,setViewMode:E}))))};document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll("[data-gemport-search]");t.length&&t.forEach((t=>{(0,e.render)(React.createElement(m,{element:t}),t)}))}))})();