(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,a=(0,e.createContext)(),s="LOADING",l="SUCCESS",c="ERROR",n=({children:t,classNameBase:a})=>{const s=(0,e.useRef)(null);return React.createElement("div",{ref:s,className:`wp-block-buttons is-layout-flex wp-block-buttons-is-layout-flex ${a}__buttons ${a}__buttons--back`},t)},r=({label:e="",buttonKey:t="",url:a=null,classNameBase:s,onClick:l})=>React.createElement("div",{className:`wp-block-button ${s}__button ${s}__button--${t}`},!!a&&React.createElement("a",{className:`wp-block-button__link ${s}__button-link ${s}__button-link--${t}`,href:a,dangerouslySetInnerHTML:{__html:e}}),!a&&React.createElement("button",{className:`wp-block-button__link ${s}__button-link ${s}__button-link--${t}`,type:"button",onClick:l,dangerouslySetInnerHTML:{__html:e}})),o=()=>{const[o,i]=(()=>{const[t,a]=(0,e.useState)({state:"IDLE",error:"",data:[],headers:{}});return[t,e=>{a({...t,state:s}),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw Error({status:e.status,text:e.statusText||""});return e.json()})).then((e=>{a({state:l,data:e})})).catch((e=>{a({state:c,error:e.statusText||"fetch failed"})}))}]})(),m=(0,e.useContext)(a),{classNameBase:_,data:u,dataSearch:d,selectedThemes:h,setDataSearch:p,setSelectedThemes:$,setListData:E,setViewMode:y,listEndpoint:b}=m,R=()=>{i(b)};return(0,e.useEffect)((()=>{switch(o.state){case s:E(null);break;case c:console.error("Gemport API error",o);break;case l:E(o.data),y("list")}}),[o]),React.createElement("form",{className:`${_}__form`,onSubmit:e=>{e.preventDefault(),R()}},React.createElement("div",{className:`${_}__form-inner`},React.createElement("ul",{className:`${_}__entries`},u.map((e=>React.createElement("li",{key:e.id,className:`${_}__entry ${_}__entry--${e.id}`},React.createElement("label",{className:`${_}__entry-label ${_}__entry-label--${e.id}`,htmlFor:`${_}__entry-checkbox ${_}__entry-checkbox--${e.id}`},React.createElement("input",{type:"checkbox",id:`${_}__entry-checkbox ${_}__entry-checkbox--${e.id}`,key:e.id,value:e.id,onChange:()=>(e=>{const{entryId:t,setSelectedThemes:a}=e;a((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))})({entryId:e.id,setSelectedThemes:$}),checked:h.includes(e.id)}),React.createElement("span",{className:`${_}__entry-name`},e.name)))))),React.createElement(n,{classNameBase:_},React.createElement("input",{value:d,className:`${_}__searchfield`,onChange:e=>p(e.currentTarget.value),placeholder:(0,t.__)("Optional search text","shp_gemport_search")}),React.createElement(r,{classNameBase:_,buttonKey:"search",onClick:R,label:(0,t.__)("Search offers","shp_gemport_search")}))))},i=()=>{const s=(0,e.useContext)(a),{listData:l,classNameBase:c,setViewMode:o}=s,i=()=>React.createElement(n,{classNameBase:c},React.createElement(r,{classNameBase:c,buttonKey:"back",onClick:()=>o("form"),label:(0,t.__)("View search form","shp_gemport_search")}));return React.createElement("div",{className:`${c}__list`},React.createElement("div",{className:`${c}__list-inner`},!l?.length&&React.createElement("div",{className:`${c}__list-empty`,dangerouslySetInnerHTML:{__html:(0,t.__)("No matching offers found","shp_gemport_search")}}),!!l?.length&&React.createElement(React.Fragment,null,React.createElement(i,null),React.createElement("ul",{className:`${c}__list-entries`},l.map((e=>{let a=[];return e.contact_tel&&a.push(React.createElement("a",{href:`tel:${e.contact_tel}`},e.contact_tel)),e.contact_email&&a.push(React.createElement("a",{href:`mailto:${e.contact_email}`},e.contact_email)),React.createElement("li",{key:e.id,className:`${c}__list-entry ${c}__list-entry--${e.id}`},!!e.name&&React.createElement(React.Fragment,null,e.url&&React.createElement("h3",{className:`wp-block-heading ${c}__list-entry-title ${c}__list-entry-title--${e.id}`},React.createElement("a",{className:`${c}__list-entry-link ${c}__list-entry-link--${e.id}`,href:e.url,dangerouslySetInnerHTML:{__html:e.name}})),!e.url&&React.createElement("h3",{className:`wp-block-heading ${c}__list-entry-title ${c}__list-entry-title--${e.id}`,dangerouslySetInnerHTML:{__html:e.name}})),!!e.logo&&React.createElement("figure",{className:`wp-block-image ${c}__list-entry-figure`},!!e.url&&React.createElement("a",{className:`${c}__list-entry-link ${c}__list-entry-link--${e.id}`,href:e.url},React.createElement("img",{className:`${c}__list-entry-image ${c}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!e.url&&React.createElement("img",{className:`${c}__list-entry-image ${c}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!!e.description&&React.createElement("div",{className:`${c}__list-entry-description ${c}__list-entry-description--${e.id}`,dangerouslySetInnerHTML:{__html:e.description}}),!!a.length&&React.createElement("div",{className:`${c}__list-entry-contact ${c}__list-entry-contact--${e.id}`},React.createElement("span",{className:`${c}__list-entry-contact-label ${c}__list-entry-contact-label--${e.id}`},(0,t.__)("Contact:","shp_gemport_search")),a.map((t=>React.createElement("span",{className:`${c}__list-entry-contact-value ${c}__list-entry-contact-value--${e.id}`},t)))),!!e.url&&React.createElement("div",{className:`${c}__list-entry-more ${c}__list-entry-more--${e.id}`},React.createElement(n,null,React.createElement(r,{classNameBase:c,buttonKey:"more",url:e.url,label:(0,t.__)("More information","shp_gemport_search")}))))})))),React.createElement(i,null)))},m=({element:t})=>{const{classNameBase:n,generation:r,postcode:m}=t.dataset,[_]=(0,e.useState)(m||""),[u,d]=(0,e.useState)(""),[h,p]=(0,e.useState)([]),[$,E]=(0,e.useState)("form"),[y,b]=(0,e.useState)([]),R=(0,e.useMemo)((()=>`https://gemport.ch/gemport/public/api/themes?generation=${r}`),[]),g=h.join(","),f=(0,e.useMemo)((()=>{let e=`https://gemport.ch/gemport/public/api/offerings?zipcode=${_}`;return g&&(e+=`&theme=[${g}]`),u&&(e+=`&search=${u}`),e}),[_,g,u]),{data:N,error:k,state:S}=(t=>{const[a,n]=(0,e.useState)({state:s,error:"",data:[],headers:{}}),r=e=>n({...a,...e});return(0,e.useEffect)((()=>{r({state:s}),fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e.status&&e.status>399)throw Error({status:e.status,text:e.statusText?e.statusText:""});return e})).then((e=>e.json())).then((e=>{r({state:l,data:e})})).catch((e=>{r({state:c,error:e.statusText?e.statusText:"fetch failed"})}))}),[]),a})(R),w={classNameBase:n,element:t,data:N,dataPostcode:_,dataSearch:u,listData:y,listEndpoint:f,selectedThemes:h,setDataSearch:d,setListData:b,setSelectedThemes:p,setViewMode:E,themesEndpoint:R,viewMode:$};return S===s?"":(S===c&&console.log("Gemport API error",k),React.createElement(a.Provider,{value:w},React.createElement("div",{className:`${n}__inner`},"form"===$&&React.createElement(o,null),"list"===$&&React.createElement(i,null))))};document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll("[data-gemport-search]");t.length&&t.forEach((t=>{(0,e.render)(React.createElement(m,{element:t}),t)}))}))})();