(()=>{"use strict";const e=window.wp.element,t=(window.wp.i18n,(0,e.createContext)()),a="LOADING",n="SUCCESS",l="ERROR",s=({children:t,classNameBase:a})=>{const n=(0,e.useRef)(null);return React.createElement("div",{ref:n,className:`wp-block-buttons is-layout-flex wp-block-buttons-is-layout-flex ${a}__buttons ${a}__buttons--back`},t)},c=({label:e="",buttonKey:t="",url:a=null,classNameBase:n,onClick:l})=>React.createElement("div",{className:`wp-block-button ${n}__button ${n}__button--${t}`},!!a&&React.createElement("a",{className:`wp-block-button__link ${n}__button-link ${n}__button-link--${t}`,href:a,dangerouslySetInnerHTML:{__html:e}}),!a&&React.createElement("button",{className:`wp-block-button__link ${n}__button-link ${n}__button-link--${t}`,type:"button",onClick:l,dangerouslySetInnerHTML:{__html:e}})),r=()=>{const[r,i]=(()=>{const[t,s]=(0,e.useState)({state:"IDLE",error:"",data:[],headers:{}});return[t,e=>{s({...t,state:a}),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((async e=>e.ok?e.json():e.json().then((e=>{throw new Error(e.error)})))).then((e=>{s({state:n,data:e})})).catch((e=>{s({state:l,error:e.message||"Unable to fetch data"})}))}]})(),m=(0,e.useContext)(t),{classNameBase:_,data:u,dataSearch:d,selectedThemes:h,setDataSearch:p,setSelectedThemes:$,setListData:E,setViewMode:y,listEndpoint:R,translations:b,viewError:g,setViewError:f}=m,N=()=>{f(""),i(R)};return(0,e.useEffect)((()=>{switch(r.state){case a:E(null);break;case l:f(r.error);break;case n:E(r.data),y("list")}}),[r]),g?React.createElement(React.Fragment,null,React.createElement("div",{className:`${_}__error-wrapper`},React.createElement("p",{className:`${_}__error-text`,dangerouslySetInnerHTML:{__html:g}})),React.createElement(o,null)):React.createElement("form",{className:`${_}__form`,onSubmit:e=>{e.preventDefault(),N()}},React.createElement("div",{className:`${_}__form-inner`},React.createElement("ul",{className:`${_}__entries`},u.map((e=>React.createElement("li",{key:e.id,className:`${_}__entry ${_}__entry--${e.id}`},React.createElement("label",{className:`${_}__entry-label ${_}__entry-label--${e.id}`,htmlFor:`${_}__entry-checkbox ${_}__entry-checkbox--${e.id}`},React.createElement("input",{type:"checkbox",id:`${_}__entry-checkbox ${_}__entry-checkbox--${e.id}`,key:e.id,value:e.id,onChange:()=>(e=>{const{entryId:t,setSelectedThemes:a}=e;a((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))})({entryId:e.id,setSelectedThemes:$}),checked:h.includes(e.id)}),React.createElement("span",{className:`${_}__entry-name`},e.name)))))),React.createElement(s,{classNameBase:_},React.createElement("input",{value:d,className:`${_}__searchfield`,onChange:e=>p(e.currentTarget.value),placeholder:b.optional_search_text}),React.createElement(c,{classNameBase:_,buttonKey:"search",onClick:N,label:b.search_offers}))))},o=()=>{const a=(0,e.useContext)(t),{classNameBase:n,translations:l,setViewMode:r,setViewError:o}=a;return React.createElement(s,{classNameBase:n},React.createElement(c,{classNameBase:n,buttonKey:"back",onClick:()=>{o(""),r("form")},label:l.view_search_form}))},i=()=>{const a=(0,e.useContext)(t),{listData:n,classNameBase:l,translations:r,setViewMode:i}=a;return React.createElement("div",{className:`${l}__list`},React.createElement("div",{className:`${l}__list-inner`},!n?.length&&React.createElement("div",{className:`${l}__list-empty`,dangerouslySetInnerHTML:{__html:r.no_matching_offers_found}}),!!n?.length&&React.createElement(React.Fragment,null,React.createElement(o,null),React.createElement("ul",{className:`${l}__list-entries`},n.map((e=>{let t=[];return e.contact_tel&&t.push(React.createElement("a",{href:`tel:${e.contact_tel}`},e.contact_tel)),e.contact_email&&t.push(React.createElement("a",{href:`mailto:${e.contact_email}`},e.contact_email)),React.createElement("li",{key:e.id,className:`${l}__list-entry ${l}__list-entry--${e.id}`},!!e.name&&React.createElement(React.Fragment,null,e.url&&React.createElement("h3",{className:`wp-block-heading ${l}__list-entry-title ${l}__list-entry-title--${e.id}`},React.createElement("a",{className:`${l}__list-entry-link ${l}__list-entry-link--${e.id}`,href:e.url,dangerouslySetInnerHTML:{__html:e.name}})),!e.url&&React.createElement("h3",{className:`wp-block-heading ${l}__list-entry-title ${l}__list-entry-title--${e.id}`,dangerouslySetInnerHTML:{__html:e.name}})),!!e.logo&&React.createElement("figure",{className:`wp-block-image ${l}__list-entry-figure`},!!e.url&&React.createElement("a",{className:`${l}__list-entry-link ${l}__list-entry-link--${e.id}`,href:e.url},React.createElement("img",{className:`${l}__list-entry-image ${l}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!e.url&&React.createElement("img",{className:`${l}__list-entry-image ${l}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!!e.description&&React.createElement("div",{className:`${l}__list-entry-description ${l}__list-entry-description--${e.id}`,dangerouslySetInnerHTML:{__html:e.description}}),!!t.length&&React.createElement("div",{className:`${l}__list-entry-contact ${l}__list-entry-contact--${e.id}`},React.createElement("span",{className:`${l}__list-entry-contact-label ${l}__list-entry-contact-label--${e.id}`},r.contact_colon),t.map((t=>React.createElement("span",{className:`${l}__list-entry-contact-value ${l}__list-entry-contact-value--${e.id}`},t)))),!!e.url&&React.createElement("div",{className:`${l}__list-entry-more ${l}__list-entry-more--${e.id}`},React.createElement(s,null,React.createElement(c,{classNameBase:l,buttonKey:"more",url:e.url,label:r.more_information}))))})))),React.createElement(o,null)))},m=({element:s})=>{const{classNameBase:c,generation:o,postcode:m,translations:_}=s.dataset,[u]=(0,e.useState)(m||""),[d,h]=(0,e.useState)(""),[p,$]=(0,e.useState)(!0),[E,y]=(0,e.useState)([]),[R,b]=(0,e.useState)([]),[g,f]=(0,e.useState)(""),[N,k]=(0,e.useState)("form"),w=(0,e.useMemo)((()=>`https://gemport.ch/gemport/public/api/themes?generation=${o}`),[]),S=R.join(","),v=(0,e.useMemo)((()=>{let e=`https://gemport.ch/gemport/public/api/offerings?zipcode=${u}`;return S&&(e+=`&theme=[${S}]`),d&&(e+=`&search=${d}`),e}),[u,S,d]);(0,e.useEffect)((()=>{$(!1)}),[]),(0,e.useEffect)((()=>{if(!s||p)return;const{top:e}=s.getBoundingClientRect(),t=getComputedStyle(document.body).getPropertyValue("--gemport-search--scroll-offset",0),a=t.match(/(\d+)px/g);let n=parseInt(t,10);a&&(n=a.reduce(((e,t)=>e+parseInt(t,10)),0));const l=parseInt(n,10);let c=e+window.scrollY-l;window.scrollTo({top:Math.max(0,c),behavior:"smooth"})}),[N,s,p]);const{data:T,error:x,state:C}=(t=>{const[s,c]=(0,e.useState)({state:a,error:"",data:[],headers:{}}),r=e=>c({...s,...e});return(0,e.useEffect)((()=>{r({state:a}),fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e.status&&e.status>399)throw Error({status:e.status,text:e.statusText?e.statusText:""});return e})).then((e=>e.json())).then((e=>{r({state:n,data:e})})).catch((e=>{r({state:l,error:e.statusText?e.statusText:"fetch failed"})}))}),[]),s})(w),M={classNameBase:c,element:s,data:T,dataPostcode:u,dataSearch:d,listData:E,listEndpoint:v,selectedThemes:R,setDataSearch:h,setListData:y,setSelectedThemes:b,setViewMode:k,themesEndpoint:w,translations:JSON.parse(_)||{},viewMode:N,viewError:g,setViewError:f};return C===a?"":(C===l&&console.log("Gemport API error",x),React.createElement(t.Provider,{value:M},React.createElement("div",{className:`${c}__inner`},"form"===N&&React.createElement(r,null),"list"===N&&React.createElement(i,null))))};document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll("[data-gemport-search]");t.length&&t.forEach((t=>{(0,e.render)(React.createElement(m,{element:t}),t)}))}))})();