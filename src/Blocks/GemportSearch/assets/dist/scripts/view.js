(()=>{"use strict";const e=window.wp.element,t=(window.wp.i18n,(0,e.createContext)()),a="LOADING",n="SUCCESS",s="ERROR",l=({children:t,classNameBase:a})=>{const n=(0,e.useRef)(null);return React.createElement("div",{ref:n,className:`wp-block-buttons is-layout-flex wp-block-buttons-is-layout-flex ${a}__buttons ${a}__buttons--back`},t)},c=({label:e="",buttonKey:t="",url:a=null,classNameBase:n,onClick:s})=>React.createElement("div",{className:`wp-block-button ${n}__button ${n}__button--${t}`},!!a&&React.createElement("a",{className:`wp-block-button__link ${n}__button-link ${n}__button-link--${t}`,href:a,dangerouslySetInnerHTML:{__html:e}}),!a&&React.createElement("button",{className:`wp-block-button__link ${n}__button-link ${n}__button-link--${t}`,type:"button",onClick:s,dangerouslySetInnerHTML:{__html:e}})),r=()=>{const[r,o]=(()=>{const[t,l]=(0,e.useState)({state:"IDLE",error:"",data:[],headers:{}});return[t,e=>{l({...t,state:a}),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw Error({status:e.status,text:e.statusText||""});return e.json()})).then((e=>{l({state:n,data:e})})).catch((e=>{l({state:s,error:e.statusText||"fetch failed"})}))}]})(),i=(0,e.useContext)(t),{classNameBase:m,data:_,dataSearch:u,selectedThemes:d,setDataSearch:h,setSelectedThemes:p,setListData:$,setViewMode:y,listEndpoint:E,translations:b}=i;console.warn(b);const R=()=>{o(E)};return(0,e.useEffect)((()=>{switch(r.state){case a:$(null);break;case s:console.error("Gemport API error",r);break;case n:$(r.data),y("list")}}),[r]),React.createElement("form",{className:`${m}__form`,onSubmit:e=>{e.preventDefault(),R()}},React.createElement("div",{className:`${m}__form-inner`},React.createElement("ul",{className:`${m}__entries`},_.map((e=>React.createElement("li",{key:e.id,className:`${m}__entry ${m}__entry--${e.id}`},React.createElement("label",{className:`${m}__entry-label ${m}__entry-label--${e.id}`,htmlFor:`${m}__entry-checkbox ${m}__entry-checkbox--${e.id}`},React.createElement("input",{type:"checkbox",id:`${m}__entry-checkbox ${m}__entry-checkbox--${e.id}`,key:e.id,value:e.id,onChange:()=>(e=>{const{entryId:t,setSelectedThemes:a}=e;a((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))})({entryId:e.id,setSelectedThemes:p}),checked:d.includes(e.id)}),React.createElement("span",{className:`${m}__entry-name`},e.name)))))),React.createElement(l,{classNameBase:m},React.createElement("input",{value:u,className:`${m}__searchfield`,onChange:e=>h(e.currentTarget.value),placeholder:b.optional_search_text}),React.createElement(c,{classNameBase:m,buttonKey:"search",onClick:R,label:b.search_offers}))))},o=()=>{const a=(0,e.useContext)(t),{listData:n,classNameBase:s,translations:r,setViewMode:o}=a,i=()=>React.createElement(l,{classNameBase:s},React.createElement(c,{classNameBase:s,buttonKey:"back",onClick:()=>o("form"),label:r.view_search_form}));return React.createElement("div",{className:`${s}__list`},React.createElement("div",{className:`${s}__list-inner`},!n?.length&&React.createElement("div",{className:`${s}__list-empty`,dangerouslySetInnerHTML:{__html:r.no_matching_offers_found}}),!!n?.length&&React.createElement(React.Fragment,null,React.createElement(i,null),React.createElement("ul",{className:`${s}__list-entries`},n.map((e=>{let t=[];return e.contact_tel&&t.push(React.createElement("a",{href:`tel:${e.contact_tel}`},e.contact_tel)),e.contact_email&&t.push(React.createElement("a",{href:`mailto:${e.contact_email}`},e.contact_email)),React.createElement("li",{key:e.id,className:`${s}__list-entry ${s}__list-entry--${e.id}`},!!e.name&&React.createElement(React.Fragment,null,e.url&&React.createElement("h3",{className:`wp-block-heading ${s}__list-entry-title ${s}__list-entry-title--${e.id}`},React.createElement("a",{className:`${s}__list-entry-link ${s}__list-entry-link--${e.id}`,href:e.url,dangerouslySetInnerHTML:{__html:e.name}})),!e.url&&React.createElement("h3",{className:`wp-block-heading ${s}__list-entry-title ${s}__list-entry-title--${e.id}`,dangerouslySetInnerHTML:{__html:e.name}})),!!e.logo&&React.createElement("figure",{className:`wp-block-image ${s}__list-entry-figure`},!!e.url&&React.createElement("a",{className:`${s}__list-entry-link ${s}__list-entry-link--${e.id}`,href:e.url},React.createElement("img",{className:`${s}__list-entry-image ${s}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!e.url&&React.createElement("img",{className:`${s}__list-entry-image ${s}__list-entry-image--${e.id}`,src:`https://gemport.ch/gemport/public/storage/public/${e.logo}`,alt:e.name})),!!e.description&&React.createElement("div",{className:`${s}__list-entry-description ${s}__list-entry-description--${e.id}`,dangerouslySetInnerHTML:{__html:e.description}}),!!t.length&&React.createElement("div",{className:`${s}__list-entry-contact ${s}__list-entry-contact--${e.id}`},React.createElement("span",{className:`${s}__list-entry-contact-label ${s}__list-entry-contact-label--${e.id}`},r.contact_colon),t.map((t=>React.createElement("span",{className:`${s}__list-entry-contact-value ${s}__list-entry-contact-value--${e.id}`},t)))),!!e.url&&React.createElement("div",{className:`${s}__list-entry-more ${s}__list-entry-more--${e.id}`},React.createElement(l,null,React.createElement(c,{classNameBase:s,buttonKey:"more",url:e.url,label:r.more_information}))))})))),React.createElement(i,null)))},i=({element:l})=>{const{classNameBase:c,generation:i,postcode:m,translations:_}=l.dataset,[u]=(0,e.useState)(m||""),[d,h]=(0,e.useState)(""),[p,$]=(0,e.useState)(!0),[y,E]=(0,e.useState)([]),[b,R]=(0,e.useState)([]),[g,f]=(0,e.useState)("form"),N=(0,e.useMemo)((()=>`https://gemport.ch/gemport/public/api/themes?generation=${i}`),[]),k=b.join(","),S=(0,e.useMemo)((()=>{let e=`https://gemport.ch/gemport/public/api/offerings?zipcode=${u}`;return k&&(e+=`&theme=[${k}]`),d&&(e+=`&search=${d}`),e}),[u,k,d]);(0,e.useEffect)((()=>{$(!1)}),[]),(0,e.useEffect)((()=>{if(!l||p)return;const{top:e}=l.getBoundingClientRect(),t=getComputedStyle(document.body).getPropertyValue("--gemport-search--scroll-offset",0),a=t.match(/(\d+)px/g);let n=parseInt(t,10);a&&(n=a.reduce(((e,t)=>e+parseInt(t,10)),0));const s=parseInt(n,10);let c=e+window.scrollY-s;window.scrollTo({top:Math.max(0,c),behavior:"smooth"})}),[g,l,p]);const{data:w,error:v,state:T}=(t=>{const[l,c]=(0,e.useState)({state:a,error:"",data:[],headers:{}}),r=e=>c({...l,...e});return(0,e.useEffect)((()=>{r({state:a}),fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e.status&&e.status>399)throw Error({status:e.status,text:e.statusText?e.statusText:""});return e})).then((e=>e.json())).then((e=>{r({state:n,data:e})})).catch((e=>{r({state:s,error:e.statusText?e.statusText:"fetch failed"})}))}),[]),l})(N),x={classNameBase:c,element:l,data:w,dataPostcode:u,dataSearch:d,listData:y,listEndpoint:S,selectedThemes:b,setDataSearch:h,setListData:E,setSelectedThemes:R,setViewMode:f,themesEndpoint:N,translations:JSON.parse(_)||{},viewMode:g};return T===a?"":(T===s&&console.log("Gemport API error",v),React.createElement(t.Provider,{value:x},React.createElement("div",{className:`${c}__inner`},"form"===g&&React.createElement(r,null),"list"===g&&React.createElement(o,null))))};document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll("[data-gemport-search]");t.length&&t.forEach((t=>{(0,e.render)(React.createElement(i,{element:t}),t)}))}))})();